<script language="javascript">
var USER_PARA = new Array
(
"ViewName",
"AppUserID",
"IP",
"MAC",
"UserName",
"Password",
"UserMode",
"UrlEnable",
"UrlTarget",
"Day",
"RelTime1",
"RelTime2"
);
var URL_BASIC_PARA = new Array(
"IsWanSrvCntl",
"IpFilterTarget",
"UrlFilterTarget",
"UrlFilterEnable",
"SrvCntlTarget",
"DefaultPolicy",
"MacFilterTarget",
"MacFilterEnable",
"PCtrlEnable"
);
var index ="";
function getmsg(id)
{

var str      = new Array();
str[0]       = new Array(101, "&?error_101;");
str[1]       = new Array(105, "&?error_105;");
str[2]       = new Array(118, "&?error_118;");
str[3]       = new Array(119, "&?error_119;");
str[4]       = new Array(122, "&?error_122;");
str[5]       = new Array(127, "&?error_127;");
str[6]       = new Array(143, "&?error_143;");
str[7]       = new Array(102, "&?error_102;");
str[8]       = new Array(103, "&?error_103;");
str[9]       = new Array(110, "&?error_110;");
str[10]      = new Array(111, "&?error_908;");
str[11]      = new Array(112, "&?error_123;");
str[12]      = new Array(114, "&?error_910;");
str[13]      = new Array(115, "&?error_123;");
str[14]      = new Array(116, "&?error_116;");
str[15]      = new Array(117, "&?error_117;");
str[16]      = new Array(120, "&?error_909;");
str[17]      = new Array(108, "&?error_108;");
str[18]      = new Array(155, "&?error_155;");
str[19]      = new Array(156, "&?error_156;");
str[20]      = new Array(199, "&?error_199;");
str[21]      = new Array(198, "&?error_198;");

return getMsgFormArray(str, arguments);
}
function pageLoad(url)
{
getObj("fSubmit").action = url;
var errstr= getValue("IF_ERRORSTR");
var errpara = getValue("IF_ERRORPARAM");
OldProcessRet(errstr, errpara);
moveErrLayer(570,4);
pageGetValue();
showTable();
}
function addline(index)
{
var newline = getObj("URL_Table").insertRow(-1);
newline.setAttribute("class", "white");
newline.setAttribute("className", "white");
cellId = "Line_" + index + "_" + USER_PARA[0] + "_" + 0;
if (getValue("UserName"+index)=="all")
{
newline.insertCell(-1).innerHTML = getNameValue(cellId, 20, "&?cpcturl016;");
}
else
{
newline.insertCell(-1).innerHTML = getNameValue(cellId, 20, getValue("UserName"+index));
}
newline.insertCell(-1).innerHTML=getImagefrmClass("multiImg_check", "Check("+index+")", "Btn_Check"+index);

newline.insertCell(-1).innerHTML=getImagefrmClass("multiImg_modify", "modify("+index+")", "Btn_Modify"+index);
newline.insertCell(-1).innerHTML=getImagefrmClass("multiImg_delete", "Delete("+index+")", "Btn_Delete"+index);
}

function showTable()
{
var num = getValue("IF_INSTNUM");
if(num != 0 )
{
for(var i = 0; i < num; i++)
{
addline(i);
}
}
else
{
var newline = getObj("URL_Table").insertRow(-1);
newline.setAttribute("align", "center");
newline.setAttribute("class", "white");
newline.setAttribute("className", "white");
var objcell =  newline.insertCell(-1);
objcell.colSpan = 4;
objcell.innerHTML= "&?note_007;"
}
jslDisable("HourSrc","MinuteSrc","HourDst","MinuteDst");
}
function getNameValue(id, size, value)
{
return ("<input type=\"text\" class=\"uiNoBorder\" size=\"" + size +"\" value=\""
+ HTMLEnCode(value) + "\"  id=\"" + id + "\"  readonly>");
}
function Add()
{
document.getElementById("add").style.display="";
document.getElementById("Btn_Edit").style.display="none";
if (pageCheckValue(-1)== true)
{
pageSetValue();
setValue("IF_ACTION", "new");
setValue("IF_INDEX", "-1");
jslDisableButton();
getObj("fSubmit").submit();
}
else
{
}
}
function Delete(i)
{
setValue("IF_ACTION", "delete");
setValue("IF_INDEX",i);
jslDisableButton();
getObj("fSubmit").submit();
}
function modify(i)
{
jslDiDisplay("add");
jslEnDisplay("Btn_Edit", "back");
index = i;
modifyGetValue(i);
if (getValue("UserMode"+i)=="ip")
{
jslDisable("Frm_SrcIP");
}
else if (getValue("UserMode"+i)=="mac")
{
jslDisable("mac1","mac2","mac3","mac4","mac5","mac6");
}
jslDisable("Frm_Mode");
jslEnable("Frm_Enable");
}
function Check(i)
{
jslDiDisplay("Btn_Edit", "add");
jslEnDisplay("back");
index = i;
modifyGetValue(i);
if (getValue("UserMode"+i)=="ip")
{
jslEnable("Frm_SrcIP");
}
else if (getValue("UserMode"+i)=="mac")
{
jslEnable("mac1","mac2","mac3","mac4","mac5","mac6");
}
jslEnable("Frm_Mode");
jslDisable("Frm_Enable");
}
function modifyGetValue(i)
{
if (getValue("PCtrlEnable")==1)
{
setChecked("Frm_Enable",true);
}
else
{
setChecked("Frm_Enable",false);
}
if (getValue("UserMode"+i)=="ip")
{
jslDiDisplay("TR_MAC");
jslEnDisplay("TR_IP");
jslSetValue("Frm_SrcIP","UserName"+i);
setValue("Frm_Mode",0);
}
else if (getValue("UserMode"+i)=="mac")
{
jslEnDisplay("TR_MAC");
jslDiDisplay("TR_IP");
setValue("Frm_Mode",1);
MacGetValue(i);
}
else if (getValue("UserMode"+i)=="all")
{
jslDiDisplay("TR_MAC");
jslDiDisplay("TR_IP");
setValue("Frm_Mode",2);
}
var weekday=getValue("Day"+i);
var len =weekday.length;
if (weekday.lastIndexOf("0") == -1)
{
setChecked("Frm_Everyday",true);
setChecked("Frm_Su",false);
setChecked("Frm_M",false);
setChecked("Frm_T",false);
setChecked("Frm_We",false);
setChecked("Frm_Th",false);
setChecked("Frm_Fri",false);
jslDisable("Frm_Su","Frm_M","Frm_T","Frm_We","Frm_Th","Frm_Fri","Frm_Sa");
}
else
{
setChecked("Frm_Everyday",false);
setChecked("Frm_Su",true);
setChecked("Frm_M",true);
setChecked("Frm_T",true);
setChecked("Frm_We",true);
setChecked("Frm_Th",true);
setChecked("Frm_Fri",true);
jslEnable("Frm_Su","Frm_M","Frm_T","Frm_We","Frm_Th",
"Frm_Fri","Frm_Sa");
if (weekday.charAt(0)=="1")
setChecked("Frm_Su",true);
else
setChecked("Frm_Su",false);
if (weekday.charAt(1)=="1")
setChecked("Frm_M",true);
else
setChecked("Frm_M",false);
if (weekday.charAt(2)=="1")
setChecked("Frm_T",true);
else
setChecked("Frm_T",false);
if (weekday.charAt(3)=="1")
setChecked("Frm_We",true);
else
setChecked("Frm_We",false);
if (weekday.charAt(4)=="1")
setChecked("Frm_Th",true);
else
setChecked("Frm_Th",false);
if (weekday.charAt(5)=="1")
setChecked("Frm_Fri",true);
else
setChecked("Frm_Fri",false);
if (weekday.charAt(6)=="1")
setChecked("Frm_Sa",true);
else
setChecked("Frm_Sa",false);
}
var timeperiodeSrc=timeChange(getValue("RelTime1"+i)).split(":");
var timeperiodeDst=timeChange(getValue("RelTime2"+i)).split(":");
if (timeperiodeDst[0]==24 && timeperiodeDst[1] ==00
&& timeperiodeSrc[0]==00 && timeperiodeSrc[1] ==00)
{
setChecked("TimePeriod", false);
setChecked("Frm_Hours", true);
setValue("HourSrc","");
setValue("MinuteSrc","");
setValue("HourDst","");
setValue("MinuteDst","");
jslDisable("HourSrc","MinuteSrc","HourDst","MinuteDst");
}
else
{
setChecked("Frm_Hours", false);
setChecked("TimePeriod", true);
jslEnable("HourSrc","MinuteSrc","HourDst","MinuteDst");
timeperiodeSrc[0]=parseTime(timeperiodeSrc[0]);
timeperiodeSrc[1]=parseTime(timeperiodeSrc[1]);
timeperiodeDst[0]=parseTime(timeperiodeDst[0]);
timeperiodeDst[1]=parseTime(timeperiodeDst[1]);
setValue("HourSrc",timeperiodeSrc[0]);
setValue("MinuteSrc",timeperiodeSrc[1]);
setValue("HourDst",timeperiodeDst[0]);
setValue("MinuteDst",timeperiodeDst[1]);
}
}
function MacGetValue(i)
{
var UserName=getValue("UserName"+i);
UserName = UserName.split(':');
for (i = 0; i < 6; i++)
{
var id = i+1;
setValue("mac"+id,UserName[i]);
}
}
function Slect_Enable()
{
jslViewToPostCheckBox("PCtrlEnable", "Frm_Enable");
setValue("IF_ACTION", "basic_apply");
jslDisableButton();
getObj("fSubmit").submit();
}
function displayUserID()
{
var UserDis=getObj("Frm_Mode");
var num = getValue("IF_INSTNUM");
for (var i=0 ; i<num;i++)
{
var tmp =getValue("UserName"+0);
if (tmp=="all")
{
}
}
}
function pageCheckValue(insId)
{

var mode=getValue("Frm_Mode");
if (mode==1)
{
var value=MacSetValue();
if(CheckMac(value) != true)
{
msg = getmsg(110);
ShowErrorForCom("mac1","Fnt_MAC",msg);
return false;
}
if( false == isSameElement(value, "UserName", insId) )
{
if( -1 == insId)   msg = getmsg(198);
else               msg = getmsg(199);
ShowErrorForCom("mac1", "", msg);
return false;
}
}
else if (mode==0)
{
ReSetIpRmZero("Frm_SrcIP");
var value=getValue("Frm_SrcIP");
if( false == checkIP("Frm_SrcIP", "Fnt_SrcIP") )
{
return  false;
}
if( false == isSameElement(value, "UserName", insId) )
{
if( -1 == insId)   msg = getmsg(198);
else               msg = getmsg(199);
ShowErrorForCom("Frm_SrcIP", "", msg);
return false;
}
}
else if (mode==2)
{
if( false == isSameElement("all", "UserName", insId) )
{
if( -1 == insId)   msg = getmsg(198);
else               msg = getmsg(199);
ShowErrorForCom("Frm_Mode", "", msg);
return false;
}
}

if (getChecked("TimePeriod")==true)
{
if (false== timeCheck())
{
return false;
}
}
if ( getChecked("Frm_Everyday")==false && getChecked("Frm_Su")==false &&
getChecked("Frm_M")==false && getChecked("Frm_T")==false &&
getChecked("Frm_We")==false && getChecked("Frm_Th")==false &&
getChecked("Frm_Fri")==false && getChecked("Frm_Sa")==false )
{
msg = getmsg(114);
ShowErrorForCom("Frm_Everyday",null,msg);
return false;
}
return true;
}
function isSameElement(value, id, modify_i)
{
var num = getValue("IF_INSTNUM");
for(var i = 0; i < num; i++)
{
if( i == modify_i )
{
continue;
}
if( value == getValue(id + i) )
{
return false;
}
if (getValue(id + i)=="all")
{
return false;
}
if ( value=="all" && num!=0)
{
return false;
}
}
return true;
}
function pageGetValue()
{
jslDisable("HourSrc","MinuteSrc","HourDst","MinuteDst");
jslPostToViewCheckBox("Frm_Enable", "PCtrlEnable");
}
function pageSetValue()
{
HiddenParaInit(USER_PARA);


var mode=getValue("Frm_Mode");
if (mode==0)
{
setValue("UserMode","ip");
jslSetValue("UserName","Frm_SrcIP");
}
else if (mode==1)
{
setValue("UserMode","mac");
setValue("UserName",MacSetValue());
}
else if (mode==2)
{
setValue("UserMode","all");
setValue("UserName","all");
}

if (getChecked("Frm_Everyday")==true)
{
setValue("Day","1111111");
}
else
{
var days;
if (getChecked("Frm_Su")==true)
{
days="1" ;
}
else
{
days="0" ;
}
if (getChecked("Frm_M")==true)
{
days+="1" ;
}
else
{
days+="0" ;
}
if (getChecked("Frm_T")==true)
{
days+="1" ;
}
else
{
days+="0" ;
}
if (getChecked("Frm_We")==true)
{
days+="1" ;
}
else
{
days+="0" ;
}
if (getChecked("Frm_Th")==true)
{
days+="1" ;
}
else
{
days+="0" ;
}
if (getChecked("Frm_Fri")==true)
{
days+="1" ;
}
else
{
days+="0" ;
}
if (getChecked("Frm_Sa")==true)
{
days+="1" ;
}
else
{
days+="0" ;
}
setValue("Day",days);
}

if (getChecked("Frm_Hours")==true)
{
setValue("RelTime1",0);
setValue("RelTime2",1440); 
}
else
{
var onHourSrc=getValue("HourSrc");
var onMinuteSrc=getValue("MinuteSrc");
var onHourDst=getValue("HourDst");
var onMinuteDst=getValue("MinuteDst");
ReSetValueRmZero(onHourSrc, onMinuteSrc, onHourDst, onMinuteDst);
var onRelTime1 = toRelTime(onHourSrc, onMinuteSrc);
var onRelTime2 = toRelTime(onHourDst, onMinuteDst);
setValue("RelTime1",onRelTime1);
setValue("RelTime2",onRelTime2);
}
}
function Slect_Mode()
{
if (getValue("Frm_Mode")==0)
{
jslDiDisplay("TR_MAC");
jslEnDisplay("TR_IP");
}
else if (getValue("Frm_Mode")==1)
{
jslEnDisplay("TR_MAC");
jslDiDisplay("TR_IP");
}
else if (getValue("Frm_Mode")==2)
{
jslDiDisplay("TR_MAC");
jslDiDisplay("TR_IP");
}
}
function Slect_day()
{
if (getChecked("Frm_Everyday")==true)
{
setChecked("Frm_Su",false);
setChecked("Frm_M",false);
setChecked("Frm_T",false);
setChecked("Frm_We",false);
setChecked("Frm_Th",false);
setChecked("Frm_Fri",false);
setChecked("Frm_Sa",false);
jslDisable("Frm_Su","Frm_M","Frm_T","Frm_We","Frm_Th","Frm_Fri","Frm_Sa");
}
else if (getChecked("Frm_Everyday")==false)
{
setChecked("Frm_Everyday",false);
jslEnable("Frm_Su","Frm_M","Frm_T","Frm_We","Frm_Th","Frm_Fri","Frm_Sa");
}
}
function Do24Hours()
{
setChecked("TimePeriod", false);
setChecked("Frm_Hours", true);
setValue("HourSrc","");
setValue("MinuteSrc","");
setValue("HourDst","");
setValue("MinuteDst","");
jslDisable("HourSrc","MinuteSrc","HourDst","MinuteDst");
}
function DoTimePeriod()
{
setChecked("Frm_Hours", false);
setChecked("TimePeriod", true);
jslEnable("HourSrc","MinuteSrc","HourDst","MinuteDst");
}
function timeChange(timevalue)
{
var timeStr;
if (timevalue==0 || timevalue=="")
{
hourSrc ="00";
minuteSrc = "00";
}
else
{
hourSrc=parseInt(timevalue/60);
minuteSrc=timevalue-hourSrc*60;
}
timeStr= hourSrc+":"+minuteSrc;
return timeStr;
}
function timeCheck()
{
if (false == checkNum("HourSrc", "Fnt_Time", 0, 23))
{
return false;
}
if (false == checkNum("MinuteSrc", "Fnt_Time", 0, 59))
{
return false;
}
if (false == checkNum("HourDst", "Fnt_Time", 0, 23))
{
return false;
}
if (false == checkNum("MinuteDst", "Fnt_Time", 0, 59))
{
return false;
}
var startMinutes = toRelTime(getValue("HourSrc"),getValue("MinuteSrc"));
var endMinutes = toRelTime(getValue("HourDst"),getValue("MinuteDst"));
if ( startMinutes >= endMinutes )
{
msg = getmsg(120);
ShowErrorForCom("HourSrc", null, msg);
return false
}
return true;
}
function Delete(i)
{
setValue("IF_ACTION", "delete");
setValue("IF_INDEX",i);
jslDisableButton();
getObj("fSubmit").submit();
}
function pageEdit()
{
if(true == pageCheckValue(index))
{
pageSetValue();
setValue("IF_ACTION", "apply");
setValue("IF_INDEX", index);
jslDisableButton();
getObj("fSubmit").submit();
}
else
{
}
}
function CheckMac(Addr)
{
var c = '';
var i = 0, j = 0;
if(Addr=="00:00:00:00:00:00")
{
return false;
}
var addrParts = Addr.split(':');
if ( addrParts.length != 6 )
return false;
for (i = 0; i < 6; i++)
{
if (addrParts[i].length != 2)
return  false;
for ( j = 0; j < addrParts[i].length; j++ )
{
c = addrParts[i].toLowerCase().charAt(j);
if ( (c >= '0' && c <= '9') ||(c >= 'a' && c <= 'f') )
continue;
else
return false;
}
}
return true;
}
function MacSetValue()
{
var value = getValue("mac1");
value += ":" + getValue("mac2");
value += ":" + getValue("mac3");
value += ":" + getValue("mac4");
value += ":" + getValue("mac5");
value += ":" + getValue("mac6");
if( ":::::" == value)
{
value = "";
}
return value;
}
function parseTime(RelTime)
{
var ret;
RelTime = parseInt(RelTime, 10);
ret = RelTime.toString(10);
if (ret.length == 1)
{
ret = "0" + ret;
}
return ret;
}
function toRelTime(hour, minute)
{
hour = parseInt(hour,10);
minute = parseInt(minute,10);
return hour*60 + minute;
}
function checkNum(frm_id, fnt_id, minValue, maxValue)
{
var msg = "";
var numCheck = checkIntegerRange(getValue(frm_id), minValue, maxValue);
if("-1" == numCheck)
{
msg = getmsg(101);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
else if("-2" == numCheck)
{
msg = getmsg(115);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
else if("-3" == numCheck)
{
msg = getmsg(116, minValue, maxValue);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
var str = getValue(frm_id);
if (str.match("^-") != null)
{
msg = getmsg(115);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
return  true;
}
function jslDisableButton()
{
var number = getValue("IF_INSTNUM");
jslDisable("add","Btn_Edit","back");
for(var i = 0; i < number; i++)
{
jslDisable("Btn_Delete" + i);
jslDisable("Btn_Modify" + i);
}
}
function back4add()
{
var number = getValue("IF_INSTNUM");
jslDisableButton();
getObj("fSubmit").submit();
}
function checkIP(frm_id, fnt_id, num)
{
var msg = "";
if(false == checkNull(getValue(frm_id)))
{
msg = getmsg(101);
ShowErrorForCom(frm_id, fnt_id, msg);
return  false;
}
if(false == checkIpAddress(getValue(frm_id), num))
{
msg = getmsg(108);
ShowErrorForCom( frm_id, fnt_id, msg);
return  false;
}
if( false == checkIPZero( getValue(frm_id) ) )
{
msg = getmsg(108);
ShowErrorForCom( frm_id, fnt_id, msg);
return  false;
}
if( "127.0.0.1" == getValue(frm_id) )
{
msg = getmsg(155);
ShowErrorForCom( frm_id, fnt_id, msg);
return  false;
}
if( "255.255.255.255" == getValue(frm_id) )
{
msg = getmsg(156);
ShowErrorForCom( frm_id, fnt_id, msg);
return  false;
}
return true;
}
function checkIPZero(value)
{
var ipaddr = value;
var parts = ipaddr.split(".");
for( var i = 0; i < 4; i++)
{
if( parseInt((parts[i]),10) != 0 )
{
return true;
}
}
return false;
}
</script>
