<%
IMPORT FILE "common_gch.gch";
IMPORT FILE "ethwanctype_gch.gch";
var FP_ACTION, FP_IDENTITY, FP_HANDLE, FP_INDEX, FP_OBJNAME;
var FP_MULTIDISPLAY, FP_INSTNUM, FP_PARANUM,FP_TYPE,FP_IDLE;
var PARA[37] =
{
"Enable",
"WANCName",
"ConnType",
"LANDViewName",
"StrServList",
"ServList",
"IsNAT",
"IsDefGW",
"IsForward",
"VLANID",
"Priority",
"WBDMode",
"IPAddress",
"SubnetMask",
"GateWay",
"DNS1",
"DNS2",
"DNS3",
"WorkIFMac",
"UpTime",
"RemainLeaseTime",
"ConnStatus",
"Addressingtype",
"DestAddress",
"ATMLinkType",
"ATMEncapsulation",
"ATMQoS",
"ATMPeakCellRate",
"ATMMaxBurstSize",
"ATMMinCellRate",
"ATMSCR",
"ATMCDV",
"RxPackets",
"TxPackets",
"RxBytes",
"TxBytes",
"MTU"
};
FP_OBJNAME = "OBJ_ETHWANCIP_ID";
FP_PARANUM = 37;
FP_IDENTITY = "";
FP_IDLE="";
FP_TYPE = request("IF_TYPE");
FP_INDEX = request("IF_INDEX");
if (FP_INDEX IS NULL)
{
FP_INDEX = -1;
}
var idle = request("IF_IDLE");
if(idle=="dhcprelease"||idle=="dhcprenew"||idle=="edit")
{
FP_IDLE=idle;
}
FP_MULTIDISPLAY = request("IF_MULTIDISPLAY");
if (FP_MULTIDISPLAY IS NULL)
{
FP_MULTIDISPLAY = -1;
}
FP_ACTION = request("IF_ACTION");
FP_INSTNUM = query_list("OBJ_ETHWANC_ID", "IGD");
if(FP_INSTNUM != 888 && FP_INSTNUM >0 && FP_INDEX >=0 && FP_ACTION != "new")
{
FP_IDENTITY = query_identity(FP_INDEX);
}
var FP_ERRORSTR = "SUCC";
create_form_start("fSubmit", "");
createBasicHidden();
create_hidden_sep("IF_INSTNUM", "");
if (FP_ACTION == "apply")
{
if (FP_INSTNUM == 888 )
{
FP_HANDLE = create_paralist();
for(var i=0; i< FP_PARANUM; i++)
{
setpara(FP_HANDLE, PARA[i]);
}
FP_IDENTITY = set_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
}
else
{
FP_HANDLE = create_paralist();
for(var i=0; i< FP_PARANUM; i++)
{
set_multiinst_para(FP_HANDLE, PARA[i], FP_INDEX);
}
FP_IDENTITY = set_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
}
}
else if (FP_ACTION == "new")
{
FP_HANDLE = create_paralist();
FP_INDEX = FP_INSTNUM;
for(var i=0; i< FP_PARANUM; i++)
{
set_multiinst_para(FP_HANDLE, PARA[i], FP_INDEX);
}
FP_IDENTITY = set_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
if(FP_IDENTITY=="")
{
FP_INDEX=-1;
}
}
else if(FP_ACTION == "delete")
{
del_inst(FP_OBJNAME, FP_IDENTITY);
FP_ERRORSTR = getDisplayInstError(FP_ERRORSTR);
if ( "SUCC" == FP_ERRORSTR )
{
FP_INDEX = -1;
}
}
else if (FP_ACTION == "dhcprelease")
{
FP_HANDLE = create_paralist();
set_para(FP_HANDLE, "CmdId", "cmd_dhcpdisconnect");
set_para(FP_HANDLE, "Identity", FP_IDENTITY);
dev_action(FP_HANDLE);
}
else if (FP_ACTION == "dhcprenew")
{
FP_HANDLE = create_paralist();
set_para(FP_HANDLE, "CmdId", "cmd_dhcpconnect");
set_para(FP_HANDLE, "Identity", FP_IDENTITY);
dev_action(FP_HANDLE);
}
else if (FP_ACTION == "wanctype")
{
var Edit_type=getenv("wanc_type");
FP_TYPE =Edit_type;
}
else
{
}
var rwanc_name = raw_request("IF_NAME");
FP_INSTNUM = query_list("OBJ_ETHWANC_ID", "IGD");
for(var i = 0; i < FP_INSTNUM; i++ )
{
var identity = query_identity(i);
var name=query_name(i);
if(rwanc_name==name)
{
FP_INDEX = i;
}
else if(rwanc_name=="&?wan002;")
{
FP_INDEX = -1;
}
else
{
}
}
create_hidden_sep("IF_INDEX", FP_INDEX);
FP_HANDLE = create_paralist();
if(FP_INSTNUM == 888)
{
get_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
create_hidden_para(FP_HANDLE, PARA, FP_PARANUM);
}
else
{
FP_INSTNUM = query_list("OBJ_ETHWANC_ID", "IGD");
for(var i = 0; i < FP_INSTNUM; i++ )
{
var identity = query_identity(i);
var wanc_name=query_name(i);
create_hidden_sep("IF_WANNAME"+i, wanc_name);
create_hidden_sep("IF_WANIDENTITY"+i, identity);
}
if(FP_MULTIDISPLAY == 0&&FP_INDEX>=0)
{
get_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
create_hidden_multiinstpara(FP_HANDLE, PARA, FP_INDEX, FP_PARANUM);
}
else if(FP_MULTIDISPLAY == 1)
{
for (var i=0; i<FP_INSTNUM; i++)
{
FP_IDENTITY = query_identity(i);
get_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
create_hidden_multiinstpara(FP_HANDLE, PARA, i, FP_PARANUM);
}
}
else
{
if(FP_INDEX==-1)
{
create_hidden_multiinstnewpara(FP_HANDLE, PARA, FP_INSTNUM, FP_PARANUM);
}
if(FP_INDEX>=0)
{
create_hidden_multiinstnewpara(FP_HANDLE, PARA, FP_INDEX, FP_PARANUM);
}
}
}
destroy_paralist(FP_HANDLE);
FP_ERRORSTR = getDisplayInstError(FP_ERRORSTR);
var Status = "";
var WAND_NUM = query_list("OBJ_CurUpType_ID", "IGD");
for(var i =0; i < WAND_NUM; i++)
{
var wand_handle = create_paralist();
var wand_identity = query_identity(i) + ".WDCommCfg";
get_inst(wand_handle, "OBJ_CurUpType_ID", wand_identity);
var curr_wanType = get_para(wand_handle, "WANAccessType");
Status = get_para(wand_handle, "PhysicalLinkStatus");
destroy_paralist(wand_handle);
if(curr_wanType == "PON")
{
break;
}
}
create_hidden_sep("IF_STATUS", Status);
create_hidden_sep("IF_MULTIDISPLAY", FP_MULTIDISPLAY);
create_hidden_sep("IF_TYPE", FP_TYPE);
create_hidden_sep("IF_NAME", "");
create_hidden_sep("IF_MODE", "");
create_hidden_sep("IF_IDLE", FP_IDLE);
set_hidden("IF_INSTNUM", FP_INSTNUM);
create_form_end();
%>
