<script language="javascript">
function getmsg(id)
{
var str      = new Array();
str[0]   = new Array(101, "&?error_101;");
str[1]   = new Array(118, "&?error_118;");
str[2]   = new Array(119, "&?error_119;");
str[3]   = new Array(122, "&?error_122;");
str[4]   = new Array(115, "&?error_123;");
str[5]   = new Array(116, "&?error_116;");
str[6]   = new Array(117, "&?error_117;");
str[7]   = new Array(123, "&?cwt07;");
return getMsgFormArray(str, arguments);
}
function pageLoad(url)
{
getObj("fSubmit").action = url;
moveErrLayer(580,95);
var errstr= getValue("IF_ERRORSTR");
var errpara = getValue("IF_ERRORPARAM");
OldProcessRet(errstr, errpara);
pageGetValue();
}
function parseTime(RelTime, mode)
{
var ret;
RelTime = parseInt(RelTime, 10);
if (mode == "hour")
{
ret = Math.floor(RelTime/60);
}
else if (mode == "minute")
{
ret = RelTime%60;
}
ret = ret.toString(10);
if (ret.length == 1)
{
ret = "0" + ret;
}
return ret;
}
function toRelTime(hour, minute)
{
hour = parseInt(hour,10);
minute = parseInt(minute,10);
return hour*60 + minute;
}
function Post2ViewTime()
{
var count24 = 0;
var sIndex;
var timeInstNum = getValue("TP_INSTNUM");
for (var i=0; i<timeInstNum; i++)
{
if ( parseTime(getValue("RelTime2"+i), "hour")=="24" )
{
count24++;
}
}
if ( count24 == 1 )
{
for (var i=0; i<timeInstNum; i++)
{
if ( parseTime(getValue("RelTime2"+i), "hour")!="24"
&& getValue("RelTime1"+i)!="0" )
{
sIndex = i;
break;
}
}
}
else if ( count24 == 2 )
{
for (var i=0; i<timeInstNum; i++)
{
if ( parseTime(getValue("RelTime2"+i), "hour")!="24" )
{
sIndex = i;
break;
}
}
}
if (getValue("ExePolicy"+sIndex) == "0")
{
setValue("Frm_on_hour", parseTime(getValue("RelTime1"+sIndex), "hour"));
setValue("Frm_on_min", parseTime(getValue("RelTime1"+sIndex), "minute"));
setValue("Frm_off_hour", parseTime(getValue("RelTime2"+sIndex), "hour"));
setValue("Frm_off_min", parseTime(getValue("RelTime2"+sIndex), "minute"));
}
else if(getValue("ExePolicy"+sIndex) == "1")
{
setValue("Frm_off_hour", parseTime(getValue("RelTime1"+sIndex), "hour"));
setValue("Frm_off_min", parseTime(getValue("RelTime1"+sIndex), "minute"));
setValue("Frm_on_hour", parseTime(getValue("RelTime2"+sIndex), "hour"));
setValue("Frm_on_min", parseTime(getValue("RelTime2"+sIndex), "minute"));
}
}
function pageGetValue()
{
Post2ViewTime();
var TimerEnable = getValue("TimerEnable");
var RadioStatus = getValue("RadioStatus");
if ( TimerEnable == "1" )
{
setHTML("Fnt_RFMODEVAL", "&?cwb1;");
}
else if ( TimerEnable == "0" )
{
if( RadioStatus == "1" )
{
setHTML("Fnt_RFMODEVAL", "&?wan049;");
}
else if ( RadioStatus == "0" )
{
setHTML("Fnt_RFMODEVAL", "&?Disabled;");
}
}
}
function pageSetValue()
{
var onHour = getValue("Frm_on_hour");
var onMinute = getValue("Frm_on_min");
var offHour = getValue("Frm_off_hour");
var offMinute = getValue("Frm_off_min");
var onRelTime = toRelTime(onHour, onMinute);
var offRelTime = toRelTime(offHour, offMinute);
var st, et, p, pr;
if (onRelTime > offRelTime)
{
st = offRelTime;
et = onRelTime;
p = 1;
}
else
{
st = onRelTime;
et = offRelTime;
p = 0;
}
pr = p==0?1:0;
setValue("RelTime1"+0, st);
setValue("RelTime2"+0, et);
setValue("ExePolicy"+0, p);
setValue("RelTime1"+1, et);
setValue("RelTime2"+1, 24*60);
setValue("ExePolicy"+1, pr);
if ( st == 0 )
{
setValue("RelTime1"+2, 24*60);
setValue("RelTime2"+2, 24*60);
setValue("ExePolicy"+2, pr);
}
else
{
setValue("RelTime1"+2, 0);
setValue("RelTime2"+2, st);
setValue("ExePolicy"+2, pr);
}
}
function checkNum(frm_id, fnt_id, minValue, maxValue)
{
var msg = "";
var numCheck = checkIntegerRange(getValue(frm_id), minValue, maxValue);
if("-1" == numCheck)
{
msg = getmsg(101);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
else if("-2" == numCheck)
{
msg = getmsg(115);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
else if("-3" == numCheck)
{
msg = getmsg(116, minValue, maxValue);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
var str = getValue(frm_id);
if (str.match("^-") != null)
{
msg = getmsg(115);
ShowErrorForCom(frm_id, fnt_id, msg);
return false;
}
return  true;
}

function checkTimeInterval()
{
var msg = "";
var offHour = getValue("Frm_off_hour");
var onHour  = getValue("Frm_on_hour");
var offMin  = getValue("Frm_off_min");
var onMin   = getValue("Frm_on_min");
var dayMinute = 24*60;
var offMinute = parseInt(offHour, 10)*60 + parseInt(offMin, 10);
var onMinnute = parseInt(onHour, 10)*60 + parseInt(onMin, 10);

var offRangeMin;
var offRangeMax;
if ((offMinute+10)%dayMinute != (offMinute+10))
{
offRangeMax = (offMinute+10)%dayMinute;
if ((onMinnute>=(offMinute-10) && onMinnute<=(dayMinute-1))
|| (onMinnute>=0 && onMinnute<=offRangeMax))
{
msg = getmsg(123);
ShowErrorForCom("Frm_off_min", null, msg);
return false;
}
}
else if ((offMinute-10) < 0)
{
offRangeMin = (offMinute-10) + dayMinute;
if ((onMinnute>=offRangeMin && onMinnute<=(dayMinute-1))
|| (onMinnute>=0 && onMinnute<=(offMinute+10)))
{
msg = getmsg(123);
ShowErrorForCom("Frm_off_min", null, msg);
return false;
}
}
else
{
if (Math.abs(offMinute-onMinnute) <= 10)
{
msg = getmsg(123);
ShowErrorForCom("Frm_off_min", null, msg);
return false;
}
}
return true;
}
function pageCheckValue()
{

if (false == checkNum("Frm_off_hour", "Fnt_Off_label", 0, 23))
{
return false;
}
if (false == checkNum("Frm_off_min", "Fnt_Off_label", 0, 59))
{
return false;
}
if (false == checkNum("Frm_on_hour", "Fnt_On_label", 0, 23))
{
return false;
}
if (false == checkNum("Frm_on_min", "Fnt_On_label", 0, 59))
{
return false;
}

if (false == checkTimeInterval())
{
return false;
}
return true;
}
function pageSubmit()
{
if(pageCheckValue() == true)
{
pageSetValue();
setValue("IF_ACTION", "apply");
DisableALL();
getObj("fSubmit").submit();
}
else
{
}
}
function pageCancel()
{
DisableALL();
getObj("fSubmit").submit();
}
</script>
