<script language="javascript">
var PARA = new Array(
"TUN46ViewName",
"TUN46WANCViewName",
"TUN46Localv4Addr",
"IsHMREMOTEAddrSrc",
"TUN46REMOTEIPAddr",
"Tunnel46name",
"Tunneltype",
"Wanctype",
"ConnStatus"
);
function getmsg(id)
{
var str      = new Array();
str[0]   = new Array(128, "&?error_128;");
str[1]   = new Array(101, "&?error_101;");
str[2]   = new Array(102, "&?error_102;");
str[3]   = new Array(103, "&?error_103;");
str[4]   = new Array(114, "&?error_114;");
str[5]   = new Array(108, "&?error_108;");
str[6]   = new Array(208, "&?error_208;");
str[7]   = new Array(200, "&?error_200;");
str[8]   = new Array(210, "&?error_210;");
str[9]   = new Array(215, "&?error_215;");
str[10]  = new Array(216, "&?error_240;");
return getMsgFormArray(str, arguments);
}
function pageLoad(url)
{
getObj("fSubmit").action = url;
var errstr= getValue("IF_ERRORSTR");
var errpara = getValue("IF_ERRORPARAM");
OldProcessRet(errstr, errpara);
moveErrLayer(590,110);
pageGetValue();
}
function getBrowser()
{
var oType = "";
if(navigator.userAgent.indexOf("MSIE")!=-1)
{
oType="IE";
}
else if(navigator.userAgent.indexOf("Firefox")!=-1)
{
oType="FIREFOX";
}
return oType;
}
function RemoteAddrChange()
{
var remoteAddr = getChecked("Frm_IsRemoteAddr");
if( remoteAddr ==  true)
{
jslEnDisplay("RemoteAddr");
}
else
{
jslDiDisplay("RemoteAddr");
}
}

function GetWanname(oper,browser)
{
var wannameobj = getObj("Frm_WANName");
var wan_namenum = getValue("WAN_NUM");
var localwanname = getValue("TUN46WANCViewName");
var k = 0;
var flag  = 0;
if(oper == "-1")
{
for(var i=0; i< wan_namenum; i++)
{
var identity = getValue("IF_WANIDENTITY"+i);
var WANNAME = getValue("IF_WANNAME"+i);
wannameobj.options[i] = new Option(WANNAME,identity);
}
}
else
{
for(var i=0; i< wan_namenum; i++)
{
var identity = getValue("IF_WANIDENTITY"+i);
var WANNAME = getValue("IF_WANNAME"+i);
if(localwanname == identity )
{
flag = 1;  
}
}
if(flag == 0 && "FIREFOX" == browser)
{
k = 1;
wannameobj.options[0] = new Option("","-2");
}
for(var i=0; i< wan_namenum; i++)
{
var identity = getValue("IF_WANIDENTITY"+i);
var WANNAME = getValue("IF_WANNAME"+i);
wannameobj.options[k] = new Option(WANNAME,identity);
k++;
}
}
}
function pageGetValue()
{
var tunnameobj = getObj("Frm_TUNNELName");
var tun_namenum = getValue("IF_INSTNUM");
var Browser=getBrowser();
tunnameobj.options[0] = new Option("&?tunnel010;","-1");
for(var i=0; i< tun_namenum; i++)
{
var tunidentity = getValue("IF_TUNIDENTITY"+i);
var tunname = getValue("IF_TUNNAME"+i);
tunnameobj.options[i+1] = new Option(tunname,tunidentity);
}
var key = getValue("IF_IDENTITY");
if (key == "")
{
key = -1;
}
GetWanname(key,Browser);
if(-1 == key)
{
jslEnDisplay("Btn_Add","Btn_Cancel");
jslDiDisplay("Btn_DoEdit","Btn_Delete");
setValue("Frm_TUNNELName","-1");
if(getValue("Frm_TUNNELType") == "8")
{
jslEnDisplay("TABLE_T46");
if(getValue("IsHMREMOTEAddrSrc") == 1)
{
jslEnDisplay("RemoteAddr");
}
else
{
jslDiDisplay("RemoteAddr");
}
}
}
else 
{
jslDiDisplay("Btn_Add","Btn_Cancel");
jslEnDisplay("Btn_DoEdit","Btn_Delete");
jslSetValue("Frm_TUNNELName","IF_IDENTITY");
if ( "" != getValue("Frm_TUNNELName") && "-1" != getValue("Frm_TUNNELName"))
{
var obj=getObj("Frm_TUNNELName");
var name=obj.options[obj.selectedIndex].text;
setValue("Frm_NewTunName",name);
}
jslSetValue("Frm_WANName","TUN46WANCViewName");
jslSetValue("Frm_TUNNELType","Tunneltype");
if(getValue("Tunneltype") == "8") 
{
jslEnDisplay("TABLE_T46");
jslSetValue("Frm_IsRemoteAddr","IsHMREMOTEAddrSrc");
jslSetValue("Frm_Localv4Addr","TUN46Localv4Addr");
if(getValue("IsHMREMOTEAddrSrc") == "1")
{
setChecked("Frm_IsRemoteAddr",true);
jslEnDisplay("RemoteAddr");
jslSetValue("Frm_RemoteAddr","TUN46REMOTEIPAddr");
}
else
{
setChecked("Frm_IsRemoteAddr",false);
jslDiDisplay("RemoteAddr");
}
}
}
}
function Change_Tunnel()
{
var TunnelType = getValue("Frm_TUNNELType");
switch(TunnelType)
{
case "8":
{
jslEnDisplay("TABLE_T46");
}
}
}
function Change_Link()
{
var link=getValue("Frm_TUNNELName");
if(link=="-1")
{
setValue("IF_IDENTITY", "-1");
setValue("IF_ACTION","NULL");

DisableALL();
getObj("fSubmit").submit();
}
else
{
setValue("IF_ACTION","Reposition");
setValue("IF_IDENTITY", link);

DisableALL();
getObj("fSubmit").submit();;
}
}
function Check_StrLengthRange(value,min,max,Frm,Fnt)
{
if (value.length < min || value.length > max)
{
msg =  getmsg(102,min,max);
ShowErrorForCom(Frm,Fnt,msg);
return false;
}
return true;
}
function CheckIPv6(value,Frm, Fnt)
{
if (""==value)
{
msg = getmsg(101);
ShowErrorForCom(Frm,Fnt,msg);
return false;
}
if ("::"==value||false==checkIPV6Address(value))
{
msg = getmsg(200);
ShowErrorForCom(Frm,Fnt,msg);
return false;
}
return true;
}
function CheckSpecialIp(value)
{
var ip;
ip = value.split('.');
if(Number(ip[0])!=192)
{
return false ;
}
if(Number(ip[1])!=0)
{
return false ;
}
if(Number(ip[2])!=0)
{
return false ;
}
if(Number(ip[3])>6 || Number(ip[3])<2)
{
return false ;
}
return true;
}
function pageCheckValue()
{
var msg="";
var newname = getValue("Frm_NewTunName");
var obj=getObj("Frm_TUNNELName");
var name0=obj.options[obj.selectedIndex].text;
var tun_namenum = getValue("IF_INSTNUM");
for(var i=0; i< tun_namenum; i++)
{
var TUNNAME = getValue("IF_TUNNAME"+i);
if(newname==TUNNAME&&newname!=name0)       
{
msg = getmsg(128);
ShowErrorForCom("Frm_NewTunName","Fnt_NewTunName",msg);
return false;
}
}
var wannum = getValue("WAN_INSTNUM");
for(var i=0; i< wannum; i++)
{
var wanname = getValue("IF_NAME"+i);
if(wanname == newname )
{
msg = getmsg(215);
ShowErrorForCom("Frm_NewTunName","Fnt_NewTunName",msg);
return false;
}
}
var t6in4_num = getValue("T6in4_INSTNUM");
for(var i=0; i< t6in4_num; i++)
{
var T6IN4NAME = getValue("IF_6IN4NAME"+i);
if(newname == T6IN4NAME)
{
msg = getmsg(215);
ShowErrorForCom("Frm_NewTunName","Fnt_NewTunName",msg);
return false;
}
}
if(Check_StrLengthRange(newname,1,32,"Frm_NewTunName","Fnt_NewTunName")!=true)
{
return false;
}
if(checkGenString(newname)!=true)
{
msg = getmsg(114);
ShowErrorForCom("Frm_NewTunName","Fnt_NewTunName",msg);
return false;
}
var tunnelType = getValue("Frm_TUNNELType");
if(Check(tunnelType,"Frm_TUNNELType","Fnt_TUNNELType")!=true)
{
return false;
}
var wan_value = getValue("Frm_WANName");
if(Check(wan_value,"Frm_WANName","Fnt_WANName")!=true)
{
return false;
}
if(tunnelType == "8")
{
var Localv4AddrIP = getValue("Frm_Localv4Addr");
if ("" == Localv4AddrIP)
{
msg =  getmsg(101);
ShowErrorForCom("Frm_Localv4Addr","Fnt_Localv4Addr",msg);
return false;
}
else if (checkIpAddress(Localv4AddrIP,"")!=true)
{
msg =  getmsg(108);
ShowErrorForCom("Frm_Localv4Addr","Fnt_Localv4Addr",msg);
return false;
}
else if (Localv4AddrIP=="0.0.0.0")
{
msg =  getmsg(108);
ShowErrorForCom("Frm_Localv4Addr","Fnt_Localv4Addr",msg);
return false;
}
if(CheckSpecialIp(Localv4AddrIP) != true)
{
msg = getmsg(208);
ShowErrorForCom("Frm_Localv4Addr","Fnt_Localv4Addr",msg);
return false;
}
if(checkRemoteAddr()!= true)
{
return false;
}
}
return true;
}
function checkRemoteAddr()
{
var remoteAddr =  getValue("Frm_RemoteAddr");
var msg;
if(getChecked("Frm_IsRemoteAddr") == true)
{
if (""==remoteAddr)
{
msg = getmsg(101);
ShowErrorForCom("Frm_RemoteAddr","Fnt_RemoteAddr",msg);
return false;
}
if((checkIPV6Address(remoteAddr)!=true && checkHostName(remoteAddr)!=true)
||("::"==remoteAddr))
{
var msg  = "";
msg = getmsg(216);
ShowErrorForCom("Frm_RemoteAddr","Fnt_RemoteAddr",msg);
return false;
}
}
return true;
}
function Check(value,Frm,Fnt)
{
if(value=="")
{
msg =  getmsg(101);
ShowErrorForCom(Frm,Fnt,msg);
return false;
}
return true;
}
function pageSetValue()
{
var tunnelname = getValue("Frm_TUNNELName");
if (tunnelname==-1)
{
setValue("IF_IDENTITY","-1");
}
else 
{
jslSetValue("IF_IDENTITY","Frm_TUNNELName");
}
jslSetValue("Tunnel46name","Frm_NewTunName");
if(getValue("Frm_TUNNELType") == "8")
{
setValue("Tunneltype","8");
setValue("IF_TUNNELTYPE","dslite");
}
jslSetValue("TUN46WANCViewName","Frm_WANName");
jslSetValue("TUN46Localv4Addr","Frm_Localv4Addr");
if(getChecked("Frm_IsRemoteAddr") == true)
{
setValue("IsHMREMOTEAddrSrc","1");
jslSetValue("TUN46REMOTEIPAddr","Frm_RemoteAddr");
}
else
{
setValue("IsHMREMOTEAddrSrc","0");
setValue("TUN46REMOTEIPAddr","NULL");
}
setValue("Wanctype","2");
}
function pageAdd()
{
ReSetIpRmZero("Frm_IsRemoteAddr");
if(pageCheckValue()==true)
{
pageSetValue();
setValue("IF_ACTION","new");
DisableALL();
getObj("fSubmit").submit();
}
}
function pageCancel()
{
DisableALL();
setValue("IF_ACTION","");
getObj("fSubmit").submit();
}
function pageEdit()
{
ReSetIpRmZero("Frm_IsRemoteAddr");
if(pageCheckValue()==true)
{
pageSetValue();
setValue("IF_ACTION","edit");
DisableALL();
getObj("fSubmit").submit();
}
}
function pageDel()
{
setValue("IF_ACTION","delete");
DisableALL();
getObj("fSubmit").submit();
}
</script>