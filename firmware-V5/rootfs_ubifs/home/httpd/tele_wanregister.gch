<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<script language = "javascript">
<%
IMPORT FILE "js/common.js";
var ParaName = "LOID:";
if(getenv("RegType") == 1)
{
ParaName = "Password:";
}
%>
</script>
<head>
<META HTTP-EQUIV="pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<meta http-equiv="Content-Type" content="text/html; charset=&?LANG;" />
<title><%=getenv("WEBTitle");%></title>
<LINK REL="stylesheet" HREF='<%=getenv("css_path_login");%>' TYPE="text/css" />
<LINK REL="stylesheet" HREF="&?csslang;" TYPE="text/css" />
<style type="text/css">
#out,#outResult {
width:360px;
height:10px !important;
border:1px solid #0055E3;
text-align:center;
position:relative;
font-size:12px;
_height:7px;
float:left;
}
#out, #outResult *{
padding:0;
margin:0;
}
#num, #numResult {
height:16px;
line-height:16px;
font-size:12px;
}
#step, #stepResult {
background:#0055E3;
width:1%;
overflow:hidden;
position:absolute;
left:0;
top:0;
height:10px;
z-index:1000;
}
</style>
</head>
<body onload="pageFresh()">
<div id="container">
<div id="head">
<div class="type"><font id=""><%=getenv("WEBTitle");%></font></div>
<div id="banner"></div>
</div>
<div id="loginArea">
<table align="center" border="0" cellpadding="0" cellspacing="0" width="778px">
<tr>
<td colspan="2" align="center" valign="top" width="778px">
<form name="fView" id="fView" method="post" onSubmit="return false;">
<table border="0" cellpadding="0" cellspacing="0" width="778px">
<tr>
<table width="100%" border="0">
<tr>
<td height="20" colspan="2" align="right" >
<a href="javascript:back();" name="registerout" id="registerout">
<font color="#000000"><u>Return To Login Page</u></font>
</a>
</td>
</tr>
<tr>
<td height="30" colspan="2" >&nbsp; </td>
</tr>
<!--注册信息填写区域-->
<tr id="register_date">
<td  align="center">
<table width="60%">
<tr>
<td align="right" width="30%" height="55"><%=ParaName;%></td>
<td align="left" width="70%" >
<input id="usr" type="text" maxLength="24"  size="12"  name="usr"  style="width:170px; height:20px"><input class="button1" type="button" name="submit" id="submit" value="Active" onclick="myDoSubmit()">
</td>
</tr>
</table>
</td>
</tr>
<!--注册进度显示区域-->
<tr id="progress_bar" style="display:none">
<td align="center">
<table>
<tr>
<td align="center" colspan="2" height="70">
<table  border="0" cellpadding="0" cellspacing="0" width="200px" height="16px" >
<tr>
<td align="center" style="text-align:center;"><div id="num">1%</div></td>
</tr>
<tr>
<td><div id="out"><div id="step"></div></div></td>
</tr>
</table>
<div style="height:5px;width:100px;"></div>
<div>Tip:&nbsp;<font id="ProgressMessage" style="font-size:12px" id="ftitle"></font></div><br>
</td>
</tr>
</table>
</td>
</tr>
<!--出错信息和成功信息提示区域-->
<tr id="result_message" style="display:none">
<td align="center">
<table>
<tr id="RegFail">
<td align="right" height="70"  width="35%" valign="top" style="padding-top:5px;">
<div>
<img id="ok" src="img/enable.gif" style="display:none">
<img id="no" src="img/disable.gif" style="display:none">
<img id="laugh" src="img/enable.gif" style="display:none">
<img id="overtime" src="img/infomsg.gif" style="display:none">
&nbsp;
</div>
</td>
<td align="left" width="65%" valign="top" style="padding-top:5px;">
<div><font id="NoteMessage" style="font-size:14px" id="ftitle"></font></div>
</td>
</tr>
<tr id="RegSucc" style="display:none">
<td align="center" colspan="2" height="70">
<table  border="0" cellpadding="0" cellspacing="0" height="16px" >
<tr>
<td align="center" style="text-align:center;"><div id="numResult">1%</div></td>
</tr>
<tr>
<td><div id="outResult"><div id="stepResult"></div></div></td>
</tr>
</table>
<div style="height:5px;width:100px;"></div>
<div><font id="ProgressMessageResult" style="font-size:12px" id="ftitle"></font></div><br>
</td>
</tr>
<tr >
<td align="center" colspan="2" height="50" valign ="top" >&nbsp;
<input type="button" class="button1"  value="Close" id="Btn_DoSure" onclick="myDoSure()" style="display:none">
</td>
</tr>
</table>
</td>
</tr>
<br>
</table>
</tr>
</table>
</form>
</td>
</tr>
</table>
</div>
<!--bottom部分开始-->
<%
if(get_config("hideCopyRight")!="Y" && getenv("CurrentVersionInfo") != 54)
{
%>
<div style="font-family: Arial;font-size: 12px;text-align:center;"> &copy;2008-<%=getenv("VerDate");%>&nbsp;ZTE Corporation.&nbsp;All rights reserved. </div>
<%
}
%>
<div class="bottom_line"></div>
<div id="bottomx"></div>
<!--bottom部分结束-->
</div>
</body>
</html>
<script language = javascript>
var RegisteringMessage = new Array();
RegisteringMessage[0]  = new Array(10,"Registering, please wait.","","");
RegisteringMessage[1]  = new Array(20,"Registering to the OLT.","","");
RegisteringMessage[2]  = new Array(40,"Obtaining IP address of management channel.","","");
RegisteringMessage[3]  = new Array(60,"Begins to register on the ACS.","","");
RegisteringMessage[4]  = new Array(80,"","","Service is being distributed, please don't power off.");
var TotalResultMessage = new Array();
TotalResultMessage[0]  = new Array(0,"Tip: Service distribution successful");
TotalResultMessage[1]  = new Array(1,"Internal error, please try again later.");
TotalResultMessage[2]  = new Array(2,"OLT registration failure, please check optical light is turned off and whether the password is correct.");
TotalResultMessage[3]  = new Array(101,"OLT registration failure, please check optical light is turned off and whether the password is correct.");
TotalResultMessage[4]  = new Array(102,"OLT registration failure, please check optical light is turned off and whether the password is correct.");
TotalResultMessage[5]  = new Array(201,"Failed to obtain the IP address of management channel.");
TotalResultMessage[6]  = new Array(301,"Failed to register to the ACS, please check whether the Password is wrong.");
TotalResultMessage[7]  = new Array(302,"Failed to register to the ACS, please check whether the Password is wrong.");
TotalResultMessage[8]  = new Array(303,"Failed to register to the ACS, please check whether the Password is wrong.");
TotalResultMessage[9]  = new Array(401,"Failed to configure the CPE by the ACS, please contact the ACS administrator to check the cause of the failure.");
TotalResultMessage[10]  = new Array(402,"Failed to configure the CPE by the ACS, please contact the ACS administrator to check the cause of the failure.");
var ServiceMessage = new Array();
ServiceMessage[0]  = new Array("INTERNET","Internet");
ServiceMessage[1]  = new Array("VOIP","VoIP");
ServiceMessage[2]  = new Array("IPTV","IPTV");
ServiceMessage[3]  = new Array("OTHER","Other");
var PercentageModule = new Array(0,39,20,13,10);
var ChNumber = new Array("","one","two","three","four");
var ajaxObj    = new AJAXObj();
var submitFlag = 0;
var Service    = "";
var RecievedServiceName = "";
var RecievedServiceNum  = 0;
var ErrRetryTimes = 0;
var MaxErrRetryTimes = 20;
var RegType        =  0;
function pageFresh()
{
ajaxObj.post("ajax_user_register.gch", pageUpdate);
}
function doRefresh()
{
setTimeout("pageFresh()", 4000);
}
function parseService(ServiceName)
{
var count = 0;
Service = "";
for(var i=0;i<ServiceMessage.length;i++)
{
if(ServiceName.match(ServiceMessage[i][0]) != null)
{
if(count > 0)
{
Service = Service + "、";
}
Service = Service + ServiceMessage[i][1];
count++;
if(RecievedServiceName.match(ServiceMessage[i][0]) == null)
{
RecievedServiceName = RecievedServiceName + ServiceMessage[i][0] + "/ ";
RecievedServiceNum++;
}
}
}
}
function showRegisteringMessage(RegisterStatus,Result,ServiceNum)
{
var i = RegisterStatus - 30;
var ProgressMessage = RegisteringMessage[0][1];
var stepNum = RegisteringMessage[0][0];
RegisteringMessage[4][2] = Service;
if(i < RegisteringMessage.length)
{
stepNum = RegisteringMessage[i][0];
ProgressMessage = RegisteringMessage[i][1] + RegisteringMessage[i][2] + RegisteringMessage[i][3];
}
if(stepNum > 99)
{
stepNum = 99;
}
getObj("ProgressMessage").innerHTML = ProgressMessage;
getObj("step").style.width = stepNum + "%";
getObj("num").innerHTML = stepNum + "%";
}
function showRegisterResultMessage(ErrorCode,Status,Result,Maxconut,NeedReboot)
{
var ResultMessage = "";
for(var i=0;i<TotalResultMessage.length;i++)
{
if(ErrorCode == TotalResultMessage[i][0])
{
ResultMessage = TotalResultMessage[i][1];
break;
}
}
ResultMessage = changeRegType(ResultMessage);
if(ErrorCode == 0)
{
if(Service != "")
{
ResultMessage = ResultMessage +"，共下发了" + Service + ChNumber[RecievedServiceNum] + "个业务";
}
if(NeedReboot)
{
ResultMessage = ResultMessage + "<br>Need Reboot, please wait.";
}
jslEnDisplay("RegSucc","Btn_DoSure");
jslDiDisplay("RegFail");
getObj("ProgressMessageResult").innerHTML = ResultMessage;
getObj("stepResult").style.width = "100%";
getObj("numResult").innerHTML = "100%";
}
else
{
jslEnDisplay("RegFail","no");
jslDiDisplay("RegSucc","Btn_DoSure","ok");
if(ErrorCode == 301)
{
if(Status == 5)
{
jslEnDisplay("ok");
jslDiDisplay("no");
}
}
submitFlag = 0;
RecievedServiceName = "";
RecievedServiceNum  = 0;
jslEnable("submit","usr");
getObj("NoteMessage").innerHTML = ResultMessage;
}
}
function showOverLimitMessage(submitFlag,Status)
{
var NoteMessage = "Failed to register to the ACS.";
if(submitFlag)
{
NoteMessage = "Failed to register to the ACS.";
}
jslEnDisplay("RegFail","Btn_DoSure","no");
jslDiDisplay("RegSucc","ok");
getObj("NoteMessage").innerHTML = NoteMessage;
}
function showInnerErrorMessage()
{
var ErrorMessage = "System is busy, please try again later.";
jslEnDisplay("RegFail","Btn_DoSure","no");
jslDiDisplay("RegSucc","ok");
getObj("NoteMessage").innerHTML = ErrorMessage;
}
function pageUpdate()
{
if ( ajaxObj.getReadyState() == xmlHTTPStatus['Loaded'] )
{
if (200 == ajaxObj.getStatus())
{
var xmlDoc2 = new XMLDocObj(ajaxObj.getResponseText());
if (xmlDoc2.xmlDoc == null)
{
alert("&?error_167;");
}
else
{
progressDate(xmlDoc2);
}
}
else
{

}
}
}
function progressDate(xmlDoc)
{
var RegisterStatus = 0;
var ErrorCode      = 0;
var Status         = 99;
var Result         = 99;
var Maxconut       = 0;
var NeedReboot     = 0;
var ServiceName    = "";
var ServiceNum     = 0;
var UserID         = "";
var UserName       = "";
var Errstr         = xmlDoc.getXMLNodeValue("IF_ERRORSTR");
if ( Errstr != "SUCC")
{
if( Errstr == "&?cmret_260;")
{
alert(Errstr);
return;
}
ErrRetryTimes++;
if( ErrRetryTimes < MaxErrRetryTimes)
{
doRefresh();
}
else
{
ErrRetryTimes = 0;
alert("Get parameters error!");
jslEnable("usr", "submit");
jslDiDisplay("progress_bar", "result_message");
}
}
else
{
ErrRetryTimes = 0;
RegisterStatus = parseInt( xmlDoc.getXMLNodeValue("RegisterStatus") );
ErrorCode = parseInt( xmlDoc.getXMLNodeValue("ErrorCode") );
Status = parseInt( xmlDoc.getXMLNodeValue("Status") );
Result = parseInt( xmlDoc.getXMLNodeValue("Result") );
Maxconut = parseInt( xmlDoc.getXMLNodeValue("Limit") ) - parseInt( xmlDoc.getXMLNodeValue("Times") );
NeedReboot = parseInt( xmlDoc.getXMLNodeValue("NeedReboot") );
ServiceNum = parseInt( xmlDoc.getXMLNodeValue("ServiceNum") );
ServiceName = xmlDoc.getXMLNodeValue("ServiceName");
UserID = xmlDoc.getXMLNodeValue("UserID");
UserName = xmlDoc.getXMLNodeValue("UserName");
RegType = parseInt( xmlDoc.getXMLNodeValue("RegType") );
if(RegType == 1)
{
setValue("usr", UserID);
}
else
{
setValue("usr", UserName);
}

if(RegisterStatus > 30)
{
doRefresh();
jslDiDisplay("result_message");
jslDisable("usr","submit");
jslEnDisplay("progress_bar");
if(RegisterStatus == 34)
{
parseService(ServiceName);
}
showRegisteringMessage(RegisterStatus,Result,ServiceNum);
submitFlag = 1;
}

else if(RegisterStatus == 2)
{
if(submitFlag)
{
jslDiDisplay("progress_bar");
jslDisable("usr","submit");
jslEnDisplay("result_message");
parseService(ServiceName);
showRegisterResultMessage(ErrorCode,Status,Result,Maxconut,NeedReboot);
}
else
{
jslDiDisplay("result_message","progress_bar");
if( Status == 5)
{
jslDisable("submit","usr");
}
else if( Status == 4)
{
jslDisable("submit","usr");
getObj("NoteMessage").innerHTML = "Failed to configure the CPE by the ACS.<br>Please reset the CPE.";
jslEnDisplay("result_message");
}
else
{
jslEnable("submit", "usr");
}
}
}

else if(RegisterStatus == 1)
{
jslDiDisplay("progress_bar");
jslDisable("usr","submit");
jslEnDisplay("result_message");
showOverLimitMessage(submitFlag,Status);
}

else
{
showInnerErrorMessage();
}
}
}
function pswCheck(value)
{
var pswLength = value.length;
if(pswLength > 256)
return false;
for(var j = 0 ;j < pswLength; j++)
{
var xx = value.charCodeAt(j);
if (xx > 0 && xx <= 255)
{
}
else
{
return false;
}
}
if (value.indexOf("\"") != -1 || value.indexOf("<") != -1 || value.indexOf(">") != -1 || value.indexOf("'") != -1)
return false;
return null;
}
function checkValue()
{
var MsgString = "";
if( getObj("usr").value == "")
{
MsgString = "Error: Password can't be empty.";
MsgString = changeRegType(MsgString);
alert(MsgString);
getObj("usr").focus();
return false;
}
if( pswCheck(getObj("usr").value) != null)
{
MsgString = "Error: Illegal characters in password.";
MsgString = changeRegType(MsgString);
alert(MsgString);
getObj("usr").focus();
return false;
}
return true;
}
function pageSetValue()
{
jslDisable("submit","usr");
ajaxObj.addPostItem("RegType", RegType);
if(RegType == 1)
{
ajaxObj.addPostItem("UserName", "NULL");
ajaxObj.addPostItem("UserID", getValue("usr"));
}
else
{
ajaxObj.addPostItem("UserName", getValue("usr"));
ajaxObj.addPostItem("UserID", "NULL");
}
ajaxObj.addPostItem("IF_ACTION","register")
<%
IMPORT FILE "auth/api.gch";
var session_token = get_csrf_session_token();
session_set("_SESSION_TOKEN", session_token);
setenv("_SESSION_TOKEN", session_token);
%>
ajaxObj.addPostItem("_SESSION_TOKEN", "<%=session_token;%>");
ajaxObj.post("ajax_user_register.gch", pageUpdate);
}
function myDoSubmit()
{
<%
if(getenv("CurrentVersionInfo") == 14)
{
%>
var mes = confirm("&?register_01;");
if(mes == true)
{
var message = checkValue();
if(message != true)
{
}
else
{
pageSetValue();
}
}
else
{}
<%
}
else
{
%>
var message = checkValue();
if(message != true)
{
}
else
{
pageSetValue();
}
<%
}
%>
}
function myDoSure()
{
var Sys = {};
var ua = navigator.userAgent.toLowerCase();
var s;
(s = ua.match(/msie ([\d.]+)/)) ? Sys.ie = s[1] :
(s = ua.match(/firefox\/([\d.]+)/)) ? Sys.firefox = s[1] :
(s = ua.match(/chrome\/([\d.]+)/)) ? Sys.chrome = s[1] :
(s = ua.match(/opera.([\d.]+)/)) ? Sys.opera = s[1] :
(s = ua.match(/version\/([\d.]+).*safari/)) ? Sys.safari = s[1] : 0;
if (Sys.firefox)
{
window.location.href = 'about:blank ';
}
else if (Sys.chrome)
{
window.open('','_self');
window.close();
}
else
{
window.opener = "whocares";
window.close();
}
}
function back()
{
document.location.href="http://192.168.1.1";
}
function changeRegType(NoteString)
{
if(RegType == 1)
{
return NoteString;
}
return NoteString.replace(/Password/i, "LOID");
}
</script>
