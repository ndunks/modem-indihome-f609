<%
IMPORT FILE "common_gch.gch";
var FP_HANDLE, FP_INSTNUM;
var FP_AppNameInst  = 0;
var vister          = "";
var FP_OBJNAME      = "OBJ_APPLST_ID";
var FP_PARANUM      = 9;
var FP_INDEX        = getInstIndex("new");
var FP_ERRORSTR     = "SUCC";
var FP_MULTIDISPLAY = 1;
var FP_ACTION       = request("IF_ACTION");
var PARA[9] =
{
"ViewName",
"Enable",
"APPName",
"Catalog",
"Protocol",
"StartPort",
"EndPort",
"StartMapPort",
"EndMapPort"
};
var FP_PREVAPPName = request("IF_PREVAPPName");
if (FP_PREVAPPName IS NULL)
{
FP_PREVAPPName = "";
}
var FP_APPName = request("IF_APPName");
if (FP_APPName IS NULL)
{
FP_APPName = "";
}

create_form_start("fSubmit", "");
createSubmitHidden(FP_MULTIDISPLAY, PARA, FP_PARANUM, FP_INDEX);
var FP_IDENTITY = getInstIdentityByAction(FP_OBJNAME, FP_MULTIDISPLAY, FP_ACTION, FP_INDEX);
FP_ERRORSTR = applyOrNewOrDelInst(FP_OBJNAME, FP_ACTION, FP_IDENTITY, PARA, FP_PARANUM, FP_ERRORSTR);
if ( FP_ACTION == "modifyName" )
{
FP_INSTNUM = query_list(FP_OBJNAME, "IGD");
for (var i = 0; i < FP_INSTNUM; i++)
{
FP_HANDLE = create_paralist();
FP_IDENTITY = query_identity(i);
get_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
if(FP_PREVAPPName == get_para(FP_HANDLE, "APPName"))
{
set_para(FP_HANDLE, "APPName", request("APPName"));
set_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
}
else
{
destroy_paralist(FP_HANDLE);
}
}
}
FP_INSTNUM = query_list(FP_OBJNAME, "IGD");
for (var i=0; i<FP_INSTNUM; i++)
{
FP_HANDLE = create_paralist();
FP_IDENTITY = query_identity(i);
get_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);
create_special_hidden_multiinstpara(FP_HANDLE, "SourceAPPName", "APPName", i);
if(FP_APPName == get_para(FP_HANDLE, "APPName"))
{
create_hidden_sep("IF_INSTID" + FP_AppNameInst, i);
FP_AppNameInst++;
create_hidden_multiinstpara(FP_HANDLE, PARA, i, FP_PARANUM);
}
destroy_paralist(FP_HANDLE);
}
getDisplayInstError(FP_ERRORSTR);
set_hidden("IF_INSTNUM", FP_INSTNUM);
create_hidden_sep("IF_APPNAMEINST", FP_AppNameInst);
create_hidden_sep("IF_APPName", FP_APPName);
create_hidden_sep("IF_PREVAPPName", FP_APPName);
create_hidden_sep("vister", request("vister") );
create_form_end();
%>
